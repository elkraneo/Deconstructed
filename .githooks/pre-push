#!/usr/bin/env bash
set -euo pipefail

repo_root="$(git rev-parse --show-toplevel)"

"$repo_root/.github/scripts/verify-dependency-sources.sh" "$repo_root"

while read -r local_ref local_sha remote_ref remote_sha; do
  if [[ -z "${local_sha:-}" ]]; then
    continue
  fi

  if [[ "$remote_sha" == "0000000000000000000000000000000000000000" ]]; then
    range="$local_sha"
  else
    range="$remote_sha..$local_sha"
  fi

  "$repo_root/.github/scripts/verify-dependency-sources.sh" "$repo_root" "$range"
done
